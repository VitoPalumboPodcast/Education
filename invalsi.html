<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Allenamento INVALSI CBT – Classe Seconda Superiore (Grado 10)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --ink: #0f172a;
      --muted: #475569;
      --card: #ffffff;
      --primary: #2563eb;
      --primary-strong: #1d4ed8;
      --accent: #fcd34d;
      --bg: linear-gradient(135deg, #f3f4f6 0%, #e0f2fe 45%, #e0e7ff 100%);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
    }

    header {
      padding: 22px 24px 10px;
    }

    .hero {
      background: radial-gradient(circle at 10% 20%, rgba(37,99,235,0.12), transparent 35%),
                  radial-gradient(circle at 90% 10%, rgba(236,72,153,0.12), transparent 36%),
                  var(--card);
      border-radius: 18px;
      padding: 20px;
      box-shadow: 0 16px 60px rgba(15, 23, 42, 0.15);
      border: 1px solid rgba(37, 99, 235, 0.08);
    }

    .hero h1 {
      margin: 0 0 6px;
      font-size: clamp(1.4rem, 2vw + 0.5rem, 2rem);
      color: var(--ink);
    }

    .hero p {
      margin: 4px 0 0;
      color: var(--muted);
    }

    .grid {
      display: grid;
      gap: 16px;
      padding: 0 24px 24px;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      align-items: start;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 12px 40px rgba(15, 23, 42, 0.12);
      border: 1px solid rgba(15, 23, 42, 0.06);
    }

    .card h2 {
      margin: 0 0 10px;
      font-size: 1.15rem;
      color: var(--ink);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: rgba(37,99,235,0.08);
      color: var(--primary-strong);
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .controls label { display: block; margin-bottom: 8px; color: var(--muted); font-weight: 600; }

    .mode-group {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    .mode-card {
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      cursor: pointer;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .mode-card input { margin-top: 4px; }

    .mode-card:hover { border-color: rgba(37, 99, 235, 0.35); box-shadow: 0 8px 24px rgba(37, 99, 235, 0.1); }

    .btn {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.25);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      width: 100%;
    }

    .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 34px rgba(37, 99, 235, 0.28); }

    .btn:disabled {
      background: #cbd5e1;
      color: #475569;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .toolbar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .stat {
      background: rgba(15, 23, 42, 0.04);
      border-radius: 12px;
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(15, 23, 42, 0.04);
    }

    .stat strong { color: var(--ink); }
    .stat span { color: var(--muted); font-weight: 600; }

    .question-area { margin-top: 16px; display: grid; gap: 12px; }

    .question-title {
      margin: 0;
      font-size: 1.05rem;
      color: var(--ink);
      font-weight: 700;
    }

    .highlight {
      background: #fef08a;
      padding: 0 4px;
      border-radius: 6px;
      font-weight: 700;
    }

    .question-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 0.92rem;
    }

    .options { display: grid; gap: 10px; }

    .option {
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
      text-align: left;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
      color: var(--ink);
      transition: border-color 0.2s, box-shadow 0.2s, transform 0.1s ease;
    }

    .option:hover { border-color: rgba(37, 99, 235, 0.4); box-shadow: 0 8px 24px rgba(37, 99, 235, 0.14); transform: translateY(-1px); }
    .option.selected { border-color: rgba(37, 99, 235, 0.7); box-shadow: inset 0 0 0 2px rgba(37, 99, 235, 0.15); }
    .option.correct { background: #ecfdf3; border-color: #22c55e; color: #166534; }
    .option.wrong { background: #fef2f2; border-color: #ef4444; color: #991b1b; }

    .feedback {
      background: #f8fafc;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid rgba(15, 23, 42, 0.06);
      color: var(--muted);
    }

    .feedback.good { color: #166534; background: #ecfdf3; border-color: #bbf7d0; }
    .feedback.bad { color: #991b1b; background: #fef2f2; border-color: #fecdd3; }

    .actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .secondary { background: #0f172a; }
    .ghost { background: #e2e8f0; color: #0f172a; box-shadow: none; }

    .progress {
      width: 100%;
      height: 10px;
      background: #e2e8f0;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 6px;
    }

    .progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #2563eb, #22c55e);
      transition: width 0.3s ease;
    }

    .history {
      max-height: 420px;
      overflow-y: auto;
      display: grid;
      gap: 8px;
    }

    .chip { padding: 4px 10px; border-radius: 999px; background: rgba(15, 23, 42, 0.06); font-weight: 600; font-size: 0.85rem; color: var(--muted); }
    .chip.good { background: rgba(34,197,94,0.15); color: #166534; }
    .chip.bad { background: rgba(239,68,68,0.15); color: #991b1b; }

    .save-block { display: grid; gap: 8px; margin-top: 10px; }
    .muted { color: var(--muted); font-size: 0.92rem; }

    @media (max-width: 720px) {
      header { padding: 18px 16px 8px; }
      .grid { padding: 0 16px 18px; }
      .card { padding: 14px; }
      .toolbar { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
    }
  </style>
</head>
<body>
  <header>
    <div class="hero">
      <div class="pill">Simulatore CBT • Grado 10 (classe seconda superiore)</div>
      <h1>Allenamento alle prove INVALSI</h1>
      <p>Modalità ispirata alla piattaforma invalsi-areaprove.cineca.it con feedback immediato, timer e salvataggio locale delle risposte.</p>
    </div>
  </header>

  <div class="grid">
    <section class="card controls">
      <h2>Imposta la sessione</h2>
      <label>Grado selezionato</label>
      <div class="pill" aria-label="Grado selezionato">Grado 10 • Secondaria di secondo grado</div>

      <label style="margin-top:12px;">Modalità</label>
      <div class="mode-group" role="radiogroup" aria-label="Modalità di prova">
        <label class="mode-card"><input type="radio" name="mode" value="full-90" checked> <div><strong>Prova completa</strong><div class="muted">Timer 90 minuti e tutte le domande disponibili.</div></div></label>
        <label class="mode-card"><input type="radio" name="mode" value="7"> <div><strong>Allenamento rapido</strong><div class="muted">Sessione di 7 domande (tempo suggerito: 15 minuti).</div></div></label>
        <label class="mode-card"><input type="radio" name="mode" value="10"> <div><strong>Allenamento esteso</strong><div class="muted">Sessione di 10 domande (tempo suggerito: 20 minuti).</div></div></label>
      </div>

      <div class="save-block">
        <button class="btn" id="start-btn">Avvia sessione</button>
        <div class="actions">
          <button class="btn ghost" id="load-btn" type="button">Carica ultimo salvataggio</button>
          <button class="btn ghost" id="save-btn" type="button" disabled>Salva sessione</button>
        </div>
        <p class="muted">Le risposte vengono salvate nel browser (localStorage) insieme a corrette/errate e tempo rimanente.</p>
      </div>
    </section>

    <section class="card">
      <h2>Stato prova</h2>
      <div class="toolbar">
        <div class="stat" aria-live="polite"><span>Timer</span><strong id="timer">90:00</strong></div>
        <div class="stat"><span>Domande totali</span><strong id="total">0</strong></div>
        <div class="stat"><span>Risposte date</span><strong id="answered">0</strong></div>
        <div class="stat"><span>Risposte esatte</span><strong id="correct">0</strong></div>
      </div>
      <div class="progress" aria-label="Progresso risposte">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="question-area" id="question-area">
        <p class="muted">Avvia una modalità per vedere la prima domanda.</p>
      </div>
    </section>

    <section class="card">
      <h2>Storico risposte</h2>
      <div class="history" id="history"></div>
    </section>
  </div>

  <script>
    const grade10QuestionBank = [
      {
        id: '2019-ita-01',
        area: 'Italiano',
        year: '2018-2019',
        text: 'Nel passaggio «La discussione si fece più intensa <span class="highlight">mano a mano</span> che l\'argomento si delineava», che funzione ha l\'espressione evidenziata?',
        options: [
          'Introduce un inciso che modifica il soggetto',
          'Indica il grado crescente dell\'azione descritta',
          'Specifica una conseguenza inattesa',
          'Sostituisce il verbo principale per ellissi'
        ],
        correct: 1,
        explanation: 'L\'espressione “mano a mano che” indica un aumento progressivo dell\'intensità dell\'azione.',
      },
      {
        id: '2019-ita-02',
        area: 'Italiano',
        year: '2018-2019',
        text: 'In un brano narrativo, la sequenza in cui il narratore descrive il luogo in cui avvengono i fatti è detta:',
        options: [
          'sequenza riflessiva',
          'sequenza dialogica',
          'sequenza descrittiva',
          'sequenza argomentativa'
        ],
        correct: 2,
        explanation: 'Quando il narratore si concentra sull\'ambiente e lo rappresenta, si tratta di sequenza descrittiva.',
      },
      {
        id: '2019-ita-03',
        area: 'Italiano',
        year: '2018-2019',
        text: 'Quale delle seguenti affermazioni esprime un\'opinione e non un fatto verificabile?',
        options: [
          'Il romanzo è stato pubblicato nel 2018.',
          'Il protagonista percorre 30 km in bicicletta.',
          'Il finale della storia è il più riuscito dell\'autore.',
          'La vicenda si svolge a Torino.'
        ],
        correct: 2,
        explanation: 'Definire un finale “più riuscito” è una valutazione soggettiva e quindi un\'opinione.',
      },
      {
        id: '2019-mat-01',
        area: 'Matematica',
        year: '2018-2019',
        text: 'Una funzione lineare passa per i punti (0,2) e (4,6). Qual è la sua equazione?',
        options: [
          'y = x + 2',
          'y = x + 4',
          'y = 2x + 2',
          'y = 2x - 2'
        ],
        correct: 0,
        explanation: 'Il coefficiente angolare è (6−2)/(4−0)=1 e l\'intercetta è 2: y = x + 2.',
      },
      {
        id: '2019-mat-02',
        area: 'Matematica',
        year: '2018-2019',
        text: 'Il 30% degli studenti di una classe pratica uno sport di squadra. Se la classe conta 25 studenti, quanti praticano uno sport di squadra?',
        options: [
          '6',
          '7',
          '8',
          '9'
        ],
        correct: 1,
        explanation: 'Il 30% di 25 è 0,30 × 25 = 7,5; arrotondando al numero intero più vicino si ottengono 7 studenti.',
      },
      {
        id: '2019-mat-03',
        area: 'Matematica',
        year: '2018-2019',
        text: 'Quale delle seguenti espressioni rappresenta la forma fattorizzata di x² − 9?',
        options: [
          '(x − 3)(x + 3)',
          'x(x − 9)',
          '(x − 9)(x + 1)',
          'x²(1 − 9)'
        ],
        correct: 0,
        explanation: 'La differenza di quadrati x² − 9 si scompone in (x − 3)(x + 3).',
      },
      {
        id: '2019-ita-04',
        area: 'Italiano',
        year: '2018-2019',
        text: 'In un testo espositivo l\'obiettivo principale è:',
        options: [
          'convincere il lettore di una tesi',
          'raccontare un\'esperienza personale',
          'informare e chiarire un argomento',
          'descrivere un luogo in modo evocativo'
        ],
        correct: 2,
        explanation: 'Il testo espositivo mira a informare e spiegare un tema con chiarezza.',
      },
      {
        id: '2019-mat-04',
        area: 'Matematica',
        year: '2018-2019',
        text: 'Se 5x − 3 = 2x + 12, qual è il valore di x?',
        options: [
          'x = 3',
          'x = 5',
          'x = −5',
          'x = −3'
        ],
        correct: 1,
        explanation: 'Portando le x da un lato otteniamo 3x = 15, quindi x = 5.',
      },
      {
        id: '2019-ita-05',
        area: 'Italiano',
        year: '2018-2019',
        text: 'Quale figura retorica è presente in: «Il silenzio urlava nella stanza vuota»?',
        options: [
          'Metafora',
          'Ossimoro',
          'Iperbole',
          'Personificazione'
        ],
        correct: 3,
        explanation: 'Il silenzio è presentato come se potesse urlare: è una personificazione.',
      },
      {
        id: '2019-mat-05',
        area: 'Matematica',
        year: '2018-2019',
        text: 'Un triangolo rettangolo ha i cateti di lunghezza 6 cm e 8 cm. Quanto misura l\'ipotenusa?',
        options: [
          '10 cm',
          '12 cm',
          '14 cm',
          '16 cm'
        ],
        correct: 0,
        explanation: 'Applicando Pitagora: √(6² + 8²) = √(36 + 64) = √100 = 10 cm.',
      },
      {
        id: '2019-ita-06',
        area: 'Italiano',
        year: '2018-2019',
        text: 'Individua il valore dell\'espressione verbale «avrebbe potuto partire»',
        options: [
          'futuro semplice',
          'condizionale passato',
          'congiuntivo imperfetto',
          'imperfetto indicativo'
        ],
        correct: 1,
        explanation: '«Avrebbe potuto partire» utilizza il condizionale passato (avrebbe + participio).',
      },
      {
        id: '2019-mat-06',
        area: 'Matematica',
        year: '2018-2019',
        text: 'La funzione y = 3x² viene traslata verso l\'alto di 4 unità. Qual è la nuova equazione?',
        options: [
          'y = 3x² + 4',
          'y = 3(x + 4)²',
          'y = 3x² − 4',
          'y = 3(x − 4)² + 4'
        ],
        correct: 0,
        explanation: 'Una traslazione verticale verso l\'alto di 4 unità aggiunge 4 al termine noto: y = 3x² + 4.',
      },

      {
        id: 'allenamento-mat-15',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Un provider di internet fissa un costo mensile C dato dalla somma tra un costo fisso F e un costo variabile proporzionale alle ore di collegamento t al prezzo di k euro all\'ora. Quale formula esprime correttamente C?',
        options: [
          'C = F · t + k · t',
          'C = F + k · t',
          'C = k + F · t',
          'C = F · k · t'
        ],
        correct: 1,
        explanation: 'Il costo totale mensile è la somma del fisso più la quota variabile per t ore: C = F + k · t.',
      },
      {
        id: 'allenamento-mat-16',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Nel mese di gennaio si è navigato per 185 ore. A febbraio le ore aumentano del 60%. Quale espressione fornisce il costo del mese di febbraio?',
        options: [
          'F + k · 185',
          'F + k · (1 + 0,6 · 185)',
          'F + k · 1,6 · 185',
          'F + k · 60 · 185'
        ],
        correct: 2,
        explanation: 'Un aumento del 60% porta le ore a 1,6 · 185; il costo è quindi F + k · 1,6 · 185.',
      },
      {
        id: 'allenamento-mat-17',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Per quali valori naturali di n la somma n² + n è sempre pari?',
        options: [
          '7n + 1 è sempre dispari',
          '1 + 2n² è sempre pari',
          'n² + n è sempre pari',
          '3n + 3 è sempre dispari'
        ],
        correct: 2,
        explanation: 'n² + n = n(n + 1) è il prodotto di due interi consecutivi: uno è sempre pari, quindi il prodotto è sempre pari.',
      },
      {
        id: 'allenamento-mat-18',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Una scalinata ha 4 gradini alti 16 cm e profondi 30 cm. La lunghezza della rampa che collega l\'inizio con la cima è circa:',
        options: [
          '170 cm',
          '184 cm',
          '102 cm',
          '136 cm'
        ],
        correct: 3,
        explanation: "Il dislivello è 4 · 16 = 64 cm e l'avanzamento 4 · 30 = 120 cm; l'ipotenusa misura √(64² + 120²) ≈ 136 cm.",
      },
      {
        id: 'allenamento-mat-19',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Tre numeri reali a, b, c sono sulla retta: −2 < a < −1; 0 < c < 1; 1 < b < 2. Quale disuguaglianza è sempre vera?',
        options: [
          '−a > c',
          '1/c < b',
          '√(−a) > 0',
          'a + c < b'
        ],
        correct: 0,
        explanation: 'a è negativo con |a| > 1, quindi −a > 1 mentre c è tra 0 e 1: ne segue −a > c. (B è falsa perché 1/c > 1.)',
      },
      {
        id: 'allenamento-mat-20',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'In una scuola 100 studenti studiano inglese, francese, spagnolo. 50 studiano inglese; 40 francese; 40 spagnolo; 8 studiano solo inglese e francese; 6 solo inglese e spagnolo; 4 solo francese e spagnolo. Quanti studiano tutte e tre le lingue?',
        options: [
          '18',
          '8',
          '4',
          '6'
        ],
        correct: 3,
        explanation: 'La somma degli insiemi singoli e doppi senza triple è 8 + 6 + 4 = 18; per arrivare a 100 servono 6 che studiano tutte le lingue.',
      },
      {
        id: 'allenamento-mat-21',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Con i dati della tabella precedente, quanti studenti studiano soltanto francese?',
        options: [
          '38',
          '28',
          '22',
          '32'
        ],
        correct: 2,
        explanation: 'Totale francese 40 = solo francese + (8 + 4) + 6 triple → solo francese = 40 − 18 = 22.',
      },
      {
        id: 'allenamento-mat-22',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Con la stessa tabella, qual è la probabilità che uno studente scelto a caso studi solo inglese?',
        options: [
          '0,5',
          '0,3',
          '0,44',
          '0,24'
        ],
        correct: 1,
        explanation: 'Gli studenti solo inglese sono 30 (50 − 8 − 6 − 6); su 100 studenti la probabilità è 30/100 = 0,3.',
      },
      {
        id: 'allenamento-mat-23',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'In un grande quadrato 7×7 si costruiscono due quadrati più piccoli (A lato 4, B lato 3) e si disegnano due rettangoli come da figura. Calcola il perimetro del poligono C che rimane nella parte inferiore.',
        options: [
          '28',
          '18',
          '32',
          '22'
        ],
        correct: 3,
        explanation: 'Il contorno rimanente misura 7 + 7 + (7 − 3) + (7 − 4) = 22 unità.',
      },
      {
        id: 'allenamento-mat-24',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Tabella ISTAT 2012 sui 19-enni: maschi mai sposati = 308 653, sposati = 325, divorziati (incognita), vedovi = 2; femmine mai sposate = 288 014, sposate (incognita), divorziate = 25, vedove (incognita). Totale maschi = 308 994; totali femmine = 291 785; totale complessivo = 600 779. Qual è il numero di maschi divorziati?',
        options: [
          '18',
          '14',
          '16',
          '15'
        ],
        correct: 1,
        explanation: "I maschi mancano all'appello 308 994 − (308 653 + 325 + 2) = 14: sono i divorziati.",
      },
      {
        id: 'allenamento-mat-25',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Dalla stessa tabella: quante femmine sono sposate?',
        options: [
          '1 256',
          '3 742',
          '2 245',
          '3 058'
        ],
        correct: 1,
        explanation: 'Le femmine sposate valgono 291 785 − (288 014 + 25 + 4) = 3 742.',
      },
      {
        id: 'allenamento-mat-26',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Dalla stessa tabella: quante femmine sono vedove?',
        options: [
          '3',
          '5',
          '8',
          '4'
        ],
        correct: 3,
        explanation: 'Dato il totale complessivo 600 779, i divorziati sono 39 → maschi 14 e femmine 25; le vedove restano 4 per chiudere i conteggi.',
      },
      {
        id: 'allenamento-mat-27',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Dalla stessa tabella: quanti sono in totale i divorziati?',
        options: [
          '35',
          '39',
          '18',
          '14'
        ],
        correct: 1,
        explanation: 'I divorziati totali sono 600 779 − (maschi non divorziati 308 980 + femmine non divorziate 291 760) = 39.',
      },
      {
        id: 'allenamento-mat-28',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Con i dati ISTAT sopra, qual è la probabilità che un 19-enne mai sposato scelto a caso sia maschio?',
        options: [
          '308 653 / 596 667',
          '288 014 / 596 667',
          '308 653 / 600 779',
          '288 014 / 600 779'
        ],
        correct: 0,
        explanation: 'Gli ever-single totali sono 308 653 + 288 014 = 596 667; la probabilità che sia maschio è 308 653 / 596 667.',
      },
      {
        id: 'allenamento-mat-29',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Un paio di scarpe costa 100 €. A dicembre il prezzo aumenta del 10%, poi ai saldi di gennaio diminuisce del 10%. Qual è il prezzo finale?',
        options: [
          '90 €',
          '91 €',
          '99 €',
          '100 €'
        ],
        correct: 2,
        explanation: 'Dopo il +10% il prezzo è 110 €; scontandolo del 10% si ottiene 110 · 0,9 = 99 €.',
      },
      {
        id: 'allenamento-mat-30',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Tabella incidenti stradali 2012: Umbria 2 358 incidenti su 3 469 km, Sicilia 12 242 incidenti su 24 809 km, Sardegna 4 022 su 8 777 km. In quale regione il rischio (incidenti per km) è maggiore?',
        options: [
          'Sicilia',
          'Sardegna',
          'Umbria',
          'Uguale per tutte'
        ],
        correct: 2,
        explanation: 'I rapporti sono circa 0,68 (Umbria), 0,49 (Sardegna), 0,49 (Sicilia): il valore più alto è in Umbria.',
      },
      {
        id: 'allenamento-mat-31',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Confrontando Sicilia e media nazionale (incidenti/km ≈ 1), il rischio in Sicilia è superiore alla media?',
        options: [
          'Sì',
          'No'
        ],
        correct: 1,
        explanation: 'Il rapporto siciliano 12 242 / 24 809 ≈ 0,49 è inferiore alla media nazionale di circa 1.',
      },
      {
        id: 'allenamento-mat-32',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Una confezione di cereali pesa 250 g e contiene 11,3 g di fibre. Qual è la percentuale di fibra?',
        options: [
          '3,9 %',
          '4,52 %',
          '5,2 %',
          '9,0 %'
        ],
        correct: 1,
        explanation: 'La percentuale è (11,3 / 250) · 100 ≈ 4,52%.',
      },
      {
        id: 'allenamento-mat-33',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Dalla stessa confezione: quanti grammi di fibra ci sono in una porzione da 30 g?',
        options: [
          '0,9 g',
          '1,4 g',
          '2,0 g',
          '3,9 g'
        ],
        correct: 1,
        explanation: 'Usando la percentuale 4,52%, in 30 g si hanno 30 · 0,0452 ≈ 1,4 g di fibre.',
      },
      {
        id: 'allenamento-mat-34',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Un test a 28 domande attribuisce +5 punti per risposta esatta, −2 per sbagliata, +1 per risposta lasciata vuota. Marco risponde a tutte e ottiene punteggio zero. Quante risposte sbagliate ha dato?',
        options: [
          '20',
          '23',
          '22',
          '24'
        ],
        correct: 0,
        explanation: 'Sia x il numero di esatte: 5x − 2(28 − x) = 0 → 7x = 56 → x = 8; le sbagliate sono 20.',
      },
      {
        id: 'allenamento-mat-35',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'In una gara di danza vengono attribuiti punteggi da 12 a 20. Un grafico mostra 3 coppie con 12 punti, 4 con 14, 6 con 15, 5 con 17, 2 con 18, 2 con 19 e 1 con 20. Quante coppie hanno partecipato?',
        options: [
          '21',
          '23',
          '22',
          '20'
        ],
        correct: 1,
        explanation: 'Il totale è 3 + 4 + 6 + 5 + 2 + 2 + 1 = 23 coppie.',
      },
      {
        id: 'allenamento-mat-36',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Con gli stessi dati: quante coppie hanno ottenuto almeno 15 punti?',
        options: [
          '13',
          '16',
          '14',
          '20'
        ],
        correct: 1,
        explanation: 'Sommiamo da 15 in su: 6 (15) + 5 (17) + 2 (18) + 2 (19) + 1 (20) = 16.',
      },
      {
        id: 'allenamento-mat-37',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Con gli stessi dati: quale è la media dei punteggi?',
        options: [
          '16,2',
          '15,7',
          '15,8',
          '16'
        ],
        correct: 1,
        explanation: 'La somma ponderata (12·3 + 14·4 + 15·6 + 17·5 + 18·2 + 19·2 + 20·1) / 23 ≈ 15,7.',
      },
      {
        id: 'allenamento-mat-38',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'In un piano cartesiano tre rette a, b, c hanno queste caratteristiche: a passa per (0, −1) e (1, 0), b per (0, 1) e (1, 0), c per (−1, 0) e (0, 1). Le equazioni proposte sono 1) y = x + 1; 2) y = x − 1; 3) y = −x + 1; 4) y = −x − 1. Quale associazione è corretta?',
        options: [
          'a → 4; b → 3; c → 1',
          'a → 2; b → 1; c → 3',
          'a → 4; b → 1; c → 3',
          'a → 2; b → 3; c → 4'
        ],
        correct: 0,
        explanation: 'a ha coefficiente −1 e intercetta −1 ⇒ y = −x − 1 (4); b ha coefficiente −1 e intercetta 1 ⇒ y = −x + 1 (3); c ha coefficiente 1 e intercetta 1 ⇒ y = x + 1 (1).',
      },
      {
        id: 'allenamento-mat-39',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'In un sistema di assi cartesiani, A è il punto (0, 3) e B è il punto (8, 7). Il coefficiente angolare della retta AB vale?',
        options: [
          '8',
          '7',
          '1/2',
          '3'
        ],
        correct: 2,
        explanation: 'Il coefficiente angolare è (7 − 3) / (8 − 0) = 4/8 = 1/2.',
      },
      {
        id: 'allenamento-mat-40',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Mauro percorre 24 km con 1 l di diesel che costa 1,70 €/l, mentre Piero percorre 13 km con 1 l di GPL che costa 0,79 €/l. Chi spende meno per km e perché?',
        options: [
          'Mauro perché 0,10 €/km < 0,07 €/km',
          'Piero perché 0,08 €/km > 0,05 €/km',
          'Mauro perché 0,08 €/km > 0,05 €/km',
          'Piero perché 0,08 €/km < 0,05 €/km'
        ],
        correct: 1,
        explanation: 'Costo diesel per km: 1,70 / 24 ≈ 0,08 €; costo GPL per km: 0,79 / 13 ≈ 0,05 € → conviene il GPL.',
      },
      {
        id: 'allenamento-mat-41',
        area: 'Matematica',
        year: 'Allenamento',
        text: 'Quale delle seguenti frazioni non può essere la probabilità di un evento?',
        options: [
          '8/7',
          '11/15',
          '20/27',
          '2/3'
        ],
        correct: 0,
        explanation: 'Le probabilità devono essere comprese tra 0 e 1: 8/7 è maggiore di 1 ed è impossibile.',
      },

    ];

    let sessionQuestions = [];
    let currentIndex = 0;
    let answeredCount = 0;
    let correctCount = 0;
    let timerInterval = null;
    let timeRemaining = 5400; // 90 min default
    let sessionActive = false;
    const saveKey = 'invalsi-grade10-session';

    const timerEl = document.getElementById('timer');
    const totalEl = document.getElementById('total');
    const answeredEl = document.getElementById('answered');
    const correctEl = document.getElementById('correct');
    const progressBar = document.getElementById('progress-bar');
    const questionArea = document.getElementById('question-area');
    const historyEl = document.getElementById('history');
    const startBtn = document.getElementById('start-btn');
    const saveBtn = document.getElementById('save-btn');
    const loadBtn = document.getElementById('load-btn');

    function shuffle(array) {
      return array.map(v => ({ v, sort: Math.random() })).sort((a, b) => a.sort - b.sort).map(({ v }) => v);
    }

    function formatTime(seconds) {
      const m = String(Math.floor(seconds / 60)).padStart(2, '0');
      const s = String(seconds % 60).padStart(2, '0');
      return `${m}:${s}`;
    }

    function buildSessionQuestions(mode) {
      const pool = shuffle([...grade10QuestionBank]);
      let count = pool.length;
      if (mode !== 'full-90') {
        count = Math.min(parseInt(mode, 10), pool.length);
      }
      return pool.slice(0, count).map(q => ({ ...q, userAnswer: null, isCorrect: false }));
    }

    function setTimer(mode) {
      if (mode === 'full-90') return 90 * 60;
      if (mode === '7') return 15 * 60;
      if (mode === '10') return 20 * 60;
      return 90 * 60;
    }

    function startSession() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      sessionQuestions = buildSessionQuestions(mode);
      timeRemaining = setTimer(mode);
      currentIndex = 0;
      answeredCount = 0;
      correctCount = 0;
      sessionActive = true;
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeRemaining -= 1;
        updateTimer();
        if (timeRemaining <= 0) {
          endSession();
        }
      }, 1000);
      updateTimer();
      totalEl.textContent = sessionQuestions.length;
      saveBtn.disabled = false;
      renderQuestion();
      updateStats();
      renderHistory();
    }

    function updateTimer() {
      timerEl.textContent = formatTime(Math.max(timeRemaining, 0));
    }

    function updateStats() {
      answeredEl.textContent = `${answeredCount}/${sessionQuestions.length}`;
      correctEl.textContent = `${correctCount}/${sessionQuestions.length}`;
      const progress = sessionQuestions.length ? (answeredCount / sessionQuestions.length) * 100 : 0;
      progressBar.style.width = `${progress}%`;
    }

    function renderQuestion() {
      if (!sessionQuestions.length) {
        questionArea.innerHTML = '<p class="muted">Non ci sono domande in questa sessione. Seleziona una modalità e riprova.</p>';
        return;
      }
      const q = sessionQuestions[currentIndex];
      const answered = q.userAnswer !== null;
      const optionsHTML = q.options.map((opt, idx) => {
        const classes = ['option'];
        if (answered) {
          if (idx === q.correct) classes.push('correct');
          if (idx === q.userAnswer && idx !== q.correct) classes.push('wrong');
          if (idx === q.userAnswer) classes.push('selected');
        }
        return `<button class="${classes.join(' ')}" data-idx="${idx}" ${answered ? 'disabled' : ''}>${opt}</button>`;
      }).join('');

      const feedback = answered
        ? `<div class="feedback ${q.isCorrect ? 'good' : 'bad'}">${q.isCorrect ? 'Risposta corretta!' : 'Risposta errata.'} ${q.explanation}</div>`
        : '<div class="feedback">Scegli una delle 4 opzioni. Il feedback è immediato.</div>';

      questionArea.innerHTML = `
        <div class="question-meta">
          <span class="chip">Domanda ${currentIndex + 1} / ${sessionQuestions.length}</span>
          <span class="chip">Area: ${q.area}</span>
          <span class="chip">Anno: ${q.year}</span>
        </div>
        <h3 class="question-title">${q.text}</h3>
        <div class="options" id="options">${optionsHTML}</div>
        ${feedback}
        <div class="actions">
          <button class="btn ghost" type="button" ${currentIndex === 0 ? 'disabled' : ''} id="prev-btn">Indietro</button>
          <button class="btn secondary" type="button" ${currentIndex === sessionQuestions.length - 1 ? 'disabled' : ''} id="next-btn">Prossima</button>
          <button class="btn" type="button" id="finish-btn">Termina e salva</button>
        </div>
      `;

      questionArea.querySelectorAll('.option').forEach(btn => {
        btn.addEventListener('click', () => handleAnswer(parseInt(btn.dataset.idx, 10)));
      });
      document.getElementById('prev-btn').addEventListener('click', () => moveQuestion(-1));
      document.getElementById('next-btn').addEventListener('click', () => moveQuestion(1));
      document.getElementById('finish-btn').addEventListener('click', endSession);
    }

    function handleAnswer(choice) {
      if (!sessionActive) return;
      const q = sessionQuestions[currentIndex];
      if (q.userAnswer !== null) return;
      q.userAnswer = choice;
      q.isCorrect = choice === q.correct;
      answeredCount += 1;
      if (q.isCorrect) correctCount += 1;
      renderQuestion();
      updateStats();
      renderHistory();
    }

    function moveQuestion(delta) {
      const target = currentIndex + delta;
      if (target < 0 || target >= sessionQuestions.length) return;
      currentIndex = target;
      renderQuestion();
    }

    function renderHistory() {
      if (!sessionQuestions.length) {
        historyEl.innerHTML = '<p class="muted">Nessuna risposta registrata.</p>';
        return;
      }
      historyEl.innerHTML = sessionQuestions.map((q, idx) => {
        const status = q.userAnswer === null ? 'In sospeso' : q.isCorrect ? 'Corretta' : 'Errata';
        const cls = q.userAnswer === null ? '' : q.isCorrect ? 'good' : 'bad';
        const chosen = q.userAnswer !== null ? q.options[q.userAnswer] : '—';
        return `<div class="stat" aria-label="Riepilogo domanda ${idx + 1}">
          <div>
            <strong>Domanda ${idx + 1}</strong><br><span class="muted">${q.area} • ${q.year}</span>
          </div>
          <div style="text-align:right;">
            <div class="chip ${cls}">${status}</div>
            <div class="muted" style="margin-top:4px;">Risposta: ${chosen}</div>
          </div>
        </div>`;
      }).join('');
    }

    function endSession() {
      if (!sessionActive) return;
      sessionActive = false;
      clearInterval(timerInterval);
      timeRemaining = Math.max(timeRemaining, 0);
      updateTimer();
      saveSession();
      const summary = `Hai risposto a ${answeredCount} su ${sessionQuestions.length} domande. Corrette: ${correctCount}.`;
      const finalFeedback = document.createElement('div');
      finalFeedback.className = 'feedback';
      finalFeedback.textContent = summary + ' Sessione salvata in locale.';
      questionArea.appendChild(finalFeedback);
    }

    function saveSession() {
      const payload = {
        sessionQuestions,
        currentIndex,
        answeredCount,
        correctCount,
        timeRemaining,
        timestamp: new Date().toISOString(),
      };
      localStorage.setItem(saveKey, JSON.stringify(payload));
    }

    function loadSession() {
      const raw = localStorage.getItem(saveKey);
      if (!raw) {
        alert('Nessun salvataggio disponibile.');
        return;
      }
      try {
        const data = JSON.parse(raw);
        sessionQuestions = data.sessionQuestions || [];
        currentIndex = data.currentIndex || 0;
        answeredCount = data.answeredCount || 0;
        correctCount = data.correctCount || 0;
        timeRemaining = data.timeRemaining || setTimer('full-90');
        sessionActive = true;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
          timeRemaining -= 1;
          updateTimer();
          if (timeRemaining <= 0) endSession();
        }, 1000);
        totalEl.textContent = sessionQuestions.length;
        saveBtn.disabled = false;
        renderQuestion();
        updateStats();
        renderHistory();
      } catch (error) {
        alert('Impossibile leggere il salvataggio. Avvia una nuova sessione.');
      }
    }

    startBtn.addEventListener('click', startSession);
    saveBtn.addEventListener('click', saveSession);
    loadBtn.addEventListener('click', loadSession);

    // Ripristina timer di default e progressi all'avvio
    updateTimer();
    updateStats();
  </script>
</body>
</html>
